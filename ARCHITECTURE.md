# ğŸ“ ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ç‰ˆæœ¬ä¿¡æ¯

- **æ¶æ„ç‰ˆæœ¬**: v2.0
- **æ¶æ„æ¨¡å¼**: Agent-Based Architecture (åŸºäºä»£ç†çš„æ¶æ„)
- **æ›´æ–°æ—¥æœŸ**: 2025-12-16

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Main Entry                           â”‚
â”‚                     (main.py / app.py)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   StockAnalysisController                   â”‚
â”‚                      (controller.py)                        â”‚
â”‚  èŒè´£ï¼š                                                      â”‚
â”‚  â€¢ ç®¡ç† Agent ç”Ÿå‘½å‘¨æœŸ                                       â”‚
â”‚  â€¢ åè°ƒæ•°æ®æµè½¬                                              â”‚
â”‚  â€¢ æ§åˆ¶ä¸šåŠ¡æµç¨‹                                              â”‚
â”‚  â€¢ ç»Ÿä¸€é”™è¯¯å¤„ç†                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                       â”‚
                  â–¼                       â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚    FetchAgent     â”‚   â”‚   AnalyseAgent    â”‚
      â”‚  (fetch-agent/)   â”‚   â”‚  (analyse-agent/) â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ èŒè´£ï¼š             â”‚   â”‚ èŒè´£ï¼š             â”‚
      â”‚ â€¢ è·å–è‚¡ç¥¨æ•°æ®     â”‚   â”‚ â€¢ AI åˆ†æ          â”‚
      â”‚ â€¢ æ•°æ®é¢„å¤„ç†       â”‚   â”‚ â€¢ ç”ŸæˆæŠ¥å‘Š         â”‚
      â”‚ â€¢ æ•°æ®æ ¼å¼åŒ–       â”‚   â”‚ â€¢ æ›´æ–°ç´¢å¼•         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                       â”‚
                â–¼                       â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Longbridge API    â”‚   â”‚  Ollama AI Model  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç»„ä»¶

### 1. Controller (æ§åˆ¶å™¨)

**æ–‡ä»¶**: `controller.py`

**ç±»**: `StockAnalysisController`

**èŒè´£**:
- ğŸ¯ **æµç¨‹ç¼–æ’**: åè°ƒå„ä¸ª Agent çš„æ‰§è¡Œé¡ºåº
- ğŸ”„ **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: åˆå§‹åŒ–å’Œæ¸…ç† Agent èµ„æº
- ğŸ“Š **çŠ¶æ€ç®¡ç†**: è·Ÿè¸ªæ‰§è¡Œå†å²å’Œç³»ç»ŸçŠ¶æ€
- âš ï¸ **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æŠ¥å‘Š
- ğŸ“ **æ—¥å¿—è®°å½•**: è¾“å‡ºè¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

**ä¸»è¦æ–¹æ³•**:
```python
initialize()                    # åˆå§‹åŒ–æ‰€æœ‰ Agent
execute_analysis(symbols)       # æ‰§è¡Œå®Œæ•´åˆ†ææµç¨‹
get_execution_history()         # è·å–æ‰§è¡Œå†å²
get_system_info()              # è·å–ç³»ç»Ÿä¿¡æ¯
cleanup()                      # æ¸…ç†èµ„æº
```

**ä½¿ç”¨ç¤ºä¾‹**:
```python
# æ–¹å¼1: ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆæ¨èï¼‰
with StockAnalysisController() as controller:
    result = controller.execute_analysis(['NVDA.US'])
    
# æ–¹å¼2: æ‰‹åŠ¨ç®¡ç†
controller = StockAnalysisController()
controller.initialize()
result = controller.execute_analysis(['NVDA.US'])
controller.cleanup()
```

### 2. FetchAgent (æ•°æ®è·å–ä»£ç†)

**æ–‡ä»¶**: `agents/fetch-agent/agent.py`

**ç±»**: `FetchAgent`

**èŒè´£**:
- ğŸ“¡ è¿æ¥ Longbridge OpenAPI
- ğŸ“¥ è·å–è‚¡ç¥¨å®æ—¶è¡Œæƒ…
- ğŸ” è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
- ğŸ“Š è®¡ç®—è¡ç”ŸæŒ‡æ ‡ï¼ˆæ¶¨è·Œå¹…ç­‰ï¼‰
- ğŸ“ æ ¼å¼åŒ–æ•°æ®ä¾›åç»­åˆ†æ

**ä¸»è¦æ–¹æ³•**:
```python
execute(symbols)                # æ‰§è¡Œæ•°æ®è·å–
format_for_analysis(result)     # æ ¼å¼åŒ–æ•°æ®
close()                         # å…³é—­è¿æ¥
```

**æ•°æ®æµ**:
```
è¾“å…¥: ['NVDA.US', 'AAPL.US']
  â†“
è°ƒç”¨ Longbridge API
  â†“
è¾“å‡º: {
  "status": "success",
  "data": {
    "NVDA.US": {
      "symbol": "NVDA.US",
      "price": {...},
      "volume": ...,
      ...
    }
  }
}
```

### 3. AnalyseAgent (åˆ†ææŠ¥å‘Šä»£ç†)

**æ–‡ä»¶**: `agents/analyse-agent/agent.py`

**ç±»**: `AnalyseAgent`

**èŒè´£**:
- ğŸ“– åŠ è½½åˆ†æç­–ç•¥
- ğŸ¤– è°ƒç”¨ AI æ¨¡å‹è¿›è¡Œåˆ†æ
- ğŸ”„ é‡è¯•æœºåˆ¶
- ğŸ“„ ç”Ÿæˆåˆ†ææŠ¥å‘Š
- ğŸ“š ç»´æŠ¤æŠ¥å‘Šç´¢å¼•

**ä¸»è¦æ–¹æ³•**:
```python
execute(formatted_data, symbols, raw_data)  # æ‰§è¡Œåˆ†æ
_analyze_with_ai(data)                      # AI åˆ†æ
_generate_report(analysis, symbols)         # ç”ŸæˆæŠ¥å‘Š
_update_report_index()                      # æ›´æ–°ç´¢å¼•
```

**æ•°æ®æµ**:
```
è¾“å…¥: æ ¼å¼åŒ–çš„è‚¡ç¥¨æ•°æ®æ–‡æœ¬
  â†“
æ„å»º AI Prompt (ç­–ç•¥ + æ•°æ®)
  â†“
è°ƒç”¨ Ollama AI
  â†“
ç”Ÿæˆåˆ†ææŠ¥å‘Š
  â†“
ä¿å­˜åˆ° report/ ç›®å½•
  â†“
è¾“å‡º: {
  "status": "success",
  "report_path": "report/stock_analysis_*.md"
}
```

## æ•°æ®æµè½¬

### å®Œæ•´æµç¨‹

```
1ï¸âƒ£ ç”¨æˆ·å¯åŠ¨ç¨‹åº
   â†“
2ï¸âƒ£ Controller åˆå§‹åŒ–
   â”œâ”€ åŠ è½½é…ç½® (.env)
   â”œâ”€ åˆå§‹åŒ– FetchAgent
   â””â”€ åˆå§‹åŒ– AnalyseAgent
   â†“
3ï¸âƒ£ æ‰§è¡Œåˆ†ææµç¨‹
   â”œâ”€ é˜¶æ®µ1: FetchAgent è·å–æ•°æ®
   â”‚   â”œâ”€ è°ƒç”¨ Longbridge API
   â”‚   â”œâ”€ è·å–å®æ—¶è¡Œæƒ…
   â”‚   â”œâ”€ è®¡ç®—è¡ç”ŸæŒ‡æ ‡
   â”‚   â””â”€ æ ¼å¼åŒ–æ•°æ®
   â”‚   
   â”œâ”€ é˜¶æ®µ2: AnalyseAgent åˆ†æ
   â”‚   â”œâ”€ åŠ è½½åˆ†æç­–ç•¥
   â”‚   â”œâ”€ è°ƒç”¨ Ollama AI
   â”‚   â”œâ”€ ç”Ÿæˆåˆ†ææŠ¥å‘Š
   â”‚   â””â”€ æ›´æ–°æŠ¥å‘Šç´¢å¼•
   â”‚   
   â””â”€ è¿”å›ç»“æœ
   â†“
4ï¸âƒ£ Controller æ¸…ç†èµ„æº
   â””â”€ å…³é—­æ‰€æœ‰è¿æ¥
```

### æ•°æ®æ ¼å¼

**1. FetchAgent è¾“å‡º**:
```json
{
  "status": "success",
  "data": {
    "NVDA.US": {
      "symbol": "NVDA.US",
      "name": "è‹±ä¼Ÿè¾¾",
      "timestamp": "2025-12-16 10:00:00",
      "price": {
        "last_done": 850.50,
        "open": 835.00,
        "high": 855.00,
        "low": 830.00,
        "prev_close": 831.00,
        "change_pct": 2.35
      },
      "volume": 45234567,
      "turnover": 38456789012.00
    }
  },
  "timestamp": "2025-12-16T10:00:00",
  "count": 1
}
```

**2. æ ¼å¼åŒ–åçš„æ•°æ®** (ä¼ ç»™ AI):
```markdown
# è‚¡ç¥¨å®æ—¶æ•°æ®

## è‹±ä¼Ÿè¾¾ (NVDA.US)

### ğŸ’° ä»·æ ¼ä¿¡æ¯
- **å½“å‰ä»·æ ¼**: $850.50
- **æ¶¨è·Œå¹…**: +2.35%
...
```

**3. AnalyseAgent è¾“å‡º**:
```json
{
  "status": "success",
  "analysis": "AI ç”Ÿæˆçš„åˆ†ææ–‡æœ¬...",
  "report_path": "report/stock_analysis_NVDA_20251216_100000.md",
  "timestamp": "2025-12-16T10:00:00",
  "symbols": ["NVDA.US"]
}
```

## ç›®å½•ç»“æ„

```
langchain-demo/
â”œâ”€â”€ main.py                         # ä¸»å…¥å£
â”œâ”€â”€ app.py                          # åº”ç”¨å…¥å£
â”œâ”€â”€ controller.py                   # å…¨å±€æ§åˆ¶å™¨ â­
â”‚
â”œâ”€â”€ agents/                         # Agent ç›®å½• â­
â”‚   â”œâ”€â”€ fetch-agent/               # æ•°æ®è·å–ä»£ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ agent.py               # FetchAgent å®ç°
â”‚   â”‚
â”‚   â””â”€â”€ analyse-agent/             # åˆ†ææŠ¥å‘Šä»£ç†
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ agent.py               # AnalyseAgent å®ç°
â”‚
â”œâ”€â”€ strategies/                     # åˆ†æç­–ç•¥
â”‚   â””â”€â”€ rating.md                  # é‡åŒ–è¯„çº§ç­–ç•¥
â”‚
â”œâ”€â”€ report/                         # æŠ¥å‘Šè¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ .gitkeep
â”‚   â””â”€â”€ README.md                  # æŠ¥å‘Šç´¢å¼•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚
â”œâ”€â”€ config.example.env             # é…ç½®æ¨¡æ¿
â”œâ”€â”€ requirements.txt               # Python ä¾èµ–
â”‚
â”œâ”€â”€ README.md                      # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md                  # å¿«é€Ÿå…¥é—¨
â””â”€â”€ ARCHITECTURE.md                # æ¶æ„æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™ (SRP)
- **FetchAgent**: åªè´Ÿè´£æ•°æ®è·å–
- **AnalyseAgent**: åªè´Ÿè´£åˆ†æå’ŒæŠ¥å‘Š
- **Controller**: åªè´Ÿè´£æµç¨‹ç¼–æ’

### 2. å¼€é—­åŸåˆ™ (OCP)
- æ˜“äºæ‰©å±•æ–°çš„ Agentï¼ˆå¦‚ TradeAgentï¼‰
- ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 

### 3. ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
- Agent ä¹‹é—´é€šè¿‡æ ‡å‡†åŒ–çš„æ•°æ®æ ¼å¼é€šä¿¡
- ä¸ç›´æ¥ä¾èµ–å…·ä½“å®ç°

### 4. æ¥å£éš”ç¦»åŸåˆ™ (ISP)
- æ¯ä¸ª Agent éƒ½æœ‰æ¸…æ™°çš„ `execute()` æ¥å£
- è¿”å›ç»Ÿä¸€çš„ç»“æœæ ¼å¼

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„ Agent

1. **åˆ›å»º Agent ç›®å½•**:
```bash
mkdir -p agents/new-agent
touch agents/new-agent/__init__.py
touch agents/new-agent/agent.py
```

2. **å®ç° Agent ç±»**:
```python
# agents/new-agent/agent.py
class NewAgent:
    def __init__(self, config=None):
        self.config = config
        self._initialize()
    
    def _initialize(self):
        # åˆå§‹åŒ–é€»è¾‘
        pass
    
    def execute(self, input_data):
        # æ‰§è¡Œé€»è¾‘
        try:
            result = self._do_something(input_data)
            return {
                "status": "success",
                "data": result,
                "timestamp": datetime.now().isoformat()
            }
        except Exception as e:
            return {
                "status": "error",
                "error": str(e),
                "timestamp": datetime.now().isoformat()
            }
```

3. **åœ¨ Controller ä¸­é›†æˆ**:
```python
# controller.py
from agents.new_agent import NewAgent

class StockAnalysisController:
    def initialize(self):
        # ...
        self.new_agent = NewAgent()
```

### ä¿®æ”¹åˆ†ææµç¨‹

åœ¨ `controller.py` çš„ `execute_analysis()` æ–¹æ³•ä¸­æ·»åŠ æ–°çš„é˜¶æ®µï¼š

```python
def execute_analysis(self, stock_symbols):
    # ... ç°æœ‰é˜¶æ®µ ...
    
    # æ–°é˜¶æ®µ
    print("é˜¶æ®µ 3/3: æ–°åŠŸèƒ½")
    new_result = self.new_agent.execute(previous_result)
    result["stages"]["new_stage"] = new_result
```

## é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡

æ‰€æœ‰é…ç½®é€šè¿‡ `.env` æ–‡ä»¶ç®¡ç†ï¼š

```env
# Longbridge API
LONGBRIDGE_APP_KEY=...
LONGBRIDGE_APP_SECRET=...
LONGBRIDGE_ACCESS_TOKEN=...

# è‚¡ç¥¨åˆ—è¡¨
STOCK_LIST=BABA.US,NVDA.US,TSLA.US

# Ollama
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=deepseek-r1:8b

# è¾“å‡º
OUTPUT_DIR=report
```

### é…ç½®ä¼˜å…ˆçº§

1. ä¼ å…¥çš„ `config` å‚æ•°ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. ç¯å¢ƒå˜é‡ (`.env` æ–‡ä»¶)
3. é»˜è®¤å€¼ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰

## é”™è¯¯å¤„ç†

### é”™è¯¯ä¼ æ’­ç­–ç•¥

```
Agent å±‚ï¼š
  æ•è·å¼‚å¸¸ â†’ è¿”å› {"status": "error", "error": "..."}

Controller å±‚ï¼š
  æ£€æŸ¥ Agent è¿”å›çŠ¶æ€ â†’ å¦‚æœå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸æˆ–è¿”å›é”™è¯¯ç»“æœ

Main å±‚ï¼š
  æ•è·æ‰€æœ‰å¼‚å¸¸ â†’ æ‰“å°å‹å¥½çš„é”™è¯¯ä¿¡æ¯ â†’ è¿”å›é€€å‡ºç 
```

### ç»Ÿä¸€çš„è¿”å›æ ¼å¼

æ‰€æœ‰ Agent çš„ `execute()` æ–¹æ³•è¿”å›ï¼š

```python
# æˆåŠŸ
{
    "status": "success",
    "data": {...},          # æˆ–å…¶ä»–æ•°æ®å­—æ®µ
    "timestamp": "...",
    ...
}

# å¤±è´¥
{
    "status": "error",
    "error": "é”™è¯¯æè¿°",
    "timestamp": "...",
}
```

## æµ‹è¯•

### å•å…ƒæµ‹è¯•

æ¯ä¸ª Agent éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼š

```bash
# æµ‹è¯• FetchAgent
python agents/fetch-agent/agent.py

# æµ‹è¯• AnalyseAgent
python agents/analyse-agent/agent.py

# æµ‹è¯• Controller
python controller.py
```

### é›†æˆæµ‹è¯•

```bash
# å®Œæ•´æµç¨‹æµ‹è¯•
python main.py
```

## æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥
- [ ] ç¼“å­˜è‚¡ç¥¨é™æ€ä¿¡æ¯
- [ ] ç¼“å­˜ AI åˆ†æç»“æœï¼ˆå¯é€‰ï¼‰

### 2. å¹¶è¡Œå¤„ç†
- [ ] å¹¶è¡Œè·å–å¤šåªè‚¡ç¥¨æ•°æ®
- [ ] æ‰¹é‡è°ƒç”¨ API

### 3. é‡è¯•æœºåˆ¶
- âœ… AnalyseAgent å·²å®ç° AI è°ƒç”¨é‡è¯•
- [ ] FetchAgent å¯æ·»åŠ  API é‡è¯•

## ç‰ˆæœ¬å†å²

### v2.0 (2025-12-16)
- âœ¨ é‡æ„ä¸º Agent-Based Architecture
- âœ¨ å¼•å…¥å…¨å±€æ§åˆ¶å™¨ Controller
- âœ¨ åˆ›å»º FetchAgent å’Œ AnalyseAgent
- âœ¨ ç»Ÿä¸€æ•°æ®æµè½¬å’Œé”™è¯¯å¤„ç†
- âœ¨ æ”¹è¿›æ—¥å¿—è¾“å‡º

### v1.0 (2025-12-15)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬
- åŸºæœ¬åŠŸèƒ½å®ç°

## æœªæ¥è§„åˆ’

### çŸ­æœŸè®¡åˆ’
- [ ] æ·»åŠ  TradeAgent (äº¤æ˜“ä»£ç†)
- [ ] æ”¯æŒå¤šç­–ç•¥å¹¶è¡Œåˆ†æ
- [ ] æ·»åŠ æ•°æ®ç¼“å­˜æœºåˆ¶

### é•¿æœŸè®¡åˆ’
- [ ] Web UI ç•Œé¢
- [ ] å®æ—¶æ•°æ®æ¨é€
- [ ] å›æµ‹ç³»ç»Ÿ
- [ ] ç­–ç•¥å¸‚åœº

## å‚è€ƒèµ„æ–™

- [Agent-Based Architecture Pattern](https://en.wikipedia.org/wiki/Agent-based_model)
- [Longbridge OpenAPI æ–‡æ¡£](https://open.longbridgeapp.com/docs)
- [LangChain æ–‡æ¡£](https://python.langchain.com/)

---

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ä¸­ï¼Œæœ€åæ›´æ–°: 2025-12-16*

